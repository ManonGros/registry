<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
<head>
<title>Source code</title>
<link rel="stylesheet" type="text/css" href="../../../../../../stylesheet.css" title="Style">
</head>
<body>
<div class="sourceContainer">
<pre><span class="sourceLineNo">001</span>package org.gbif.registry.metadata.parse;<a name="line.1"></a>
<span class="sourceLineNo">002</span><a name="line.2"></a>
<span class="sourceLineNo">003</span>import org.gbif.api.model.common.DOI;<a name="line.3"></a>
<span class="sourceLineNo">004</span>import org.gbif.api.model.registry.Contact;<a name="line.4"></a>
<span class="sourceLineNo">005</span>import org.gbif.api.model.registry.Dataset;<a name="line.5"></a>
<span class="sourceLineNo">006</span>import org.gbif.api.model.registry.Identifier;<a name="line.6"></a>
<span class="sourceLineNo">007</span>import org.gbif.api.model.registry.eml.Collection;<a name="line.7"></a>
<span class="sourceLineNo">008</span>import org.gbif.api.model.registry.eml.KeywordCollection;<a name="line.8"></a>
<span class="sourceLineNo">009</span>import org.gbif.api.model.registry.eml.temporal.DateRange;<a name="line.9"></a>
<span class="sourceLineNo">010</span>import org.gbif.api.model.registry.eml.temporal.SingleDate;<a name="line.10"></a>
<span class="sourceLineNo">011</span>import org.gbif.api.model.registry.eml.temporal.VerbatimTimePeriod;<a name="line.11"></a>
<span class="sourceLineNo">012</span>import org.gbif.api.model.registry.eml.temporal.VerbatimTimePeriodType;<a name="line.12"></a>
<span class="sourceLineNo">013</span>import org.gbif.api.vocabulary.ContactType;<a name="line.13"></a>
<span class="sourceLineNo">014</span>import org.gbif.api.vocabulary.Country;<a name="line.14"></a>
<span class="sourceLineNo">015</span>import org.gbif.api.vocabulary.IdentifierType;<a name="line.15"></a>
<span class="sourceLineNo">016</span>import org.gbif.api.vocabulary.Language;<a name="line.16"></a>
<span class="sourceLineNo">017</span>import org.gbif.api.vocabulary.MetadataType;<a name="line.17"></a>
<span class="sourceLineNo">018</span>import org.gbif.api.vocabulary.PreservationMethodType;<a name="line.18"></a>
<span class="sourceLineNo">019</span>import org.gbif.api.vocabulary.Rank;<a name="line.19"></a>
<span class="sourceLineNo">020</span>import org.gbif.registry.metadata.EMLWriter;<a name="line.20"></a>
<span class="sourceLineNo">021</span>import org.gbif.utils.file.FileUtils;<a name="line.21"></a>
<span class="sourceLineNo">022</span><a name="line.22"></a>
<span class="sourceLineNo">023</span>import java.io.IOException;<a name="line.23"></a>
<span class="sourceLineNo">024</span>import java.io.InputStream;<a name="line.24"></a>
<span class="sourceLineNo">025</span>import java.io.StringReader;<a name="line.25"></a>
<span class="sourceLineNo">026</span>import java.io.StringWriter;<a name="line.26"></a>
<span class="sourceLineNo">027</span>import java.net.MalformedURLException;<a name="line.27"></a>
<span class="sourceLineNo">028</span>import java.net.URI;<a name="line.28"></a>
<span class="sourceLineNo">029</span>import java.net.URISyntaxException;<a name="line.29"></a>
<span class="sourceLineNo">030</span>import java.net.URL;<a name="line.30"></a>
<span class="sourceLineNo">031</span>import java.nio.charset.Charset;<a name="line.31"></a>
<span class="sourceLineNo">032</span>import java.util.Calendar;<a name="line.32"></a>
<span class="sourceLineNo">033</span>import java.util.List;<a name="line.33"></a>
<span class="sourceLineNo">034</span><a name="line.34"></a>
<span class="sourceLineNo">035</span>import org.apache.commons.io.input.ReaderInputStream;<a name="line.35"></a>
<span class="sourceLineNo">036</span>import org.junit.Test;<a name="line.36"></a>
<span class="sourceLineNo">037</span><a name="line.37"></a>
<span class="sourceLineNo">038</span>import static org.junit.Assert.assertEquals;<a name="line.38"></a>
<span class="sourceLineNo">039</span>import static org.junit.Assert.assertFalse;<a name="line.39"></a>
<span class="sourceLineNo">040</span>import static org.junit.Assert.assertNotNull;<a name="line.40"></a>
<span class="sourceLineNo">041</span>import static org.junit.Assert.assertNull;<a name="line.41"></a>
<span class="sourceLineNo">042</span>import static org.junit.Assert.assertTrue;<a name="line.42"></a>
<span class="sourceLineNo">043</span>import static org.junit.Assert.fail;<a name="line.43"></a>
<span class="sourceLineNo">044</span><a name="line.44"></a>
<span class="sourceLineNo">045</span>public class DatasetParserTest {<a name="line.45"></a>
<span class="sourceLineNo">046</span><a name="line.46"></a>
<span class="sourceLineNo">047</span><a name="line.47"></a>
<span class="sourceLineNo">048</span>  @Test<a name="line.48"></a>
<span class="sourceLineNo">049</span>  public void testDetectParserType() throws Exception {<a name="line.49"></a>
<span class="sourceLineNo">050</span>    MetadataType type = DatasetParser.detectParserType(FileUtils.classpathStream("dc/worms_dc.xml"));<a name="line.50"></a>
<span class="sourceLineNo">051</span>    assertEquals(MetadataType.DC, type);<a name="line.51"></a>
<span class="sourceLineNo">052</span><a name="line.52"></a>
<span class="sourceLineNo">053</span>    type = DatasetParser.detectParserType(FileUtils.classpathStream("eml/ipt_eml.xml"));<a name="line.53"></a>
<span class="sourceLineNo">054</span>    assertEquals(MetadataType.EML, type);<a name="line.54"></a>
<span class="sourceLineNo">055</span><a name="line.55"></a>
<span class="sourceLineNo">056</span>    type = DatasetParser.detectParserType(FileUtils.classpathStream("eml/clb_eml.xml"));<a name="line.56"></a>
<span class="sourceLineNo">057</span>    assertEquals(MetadataType.EML, type);<a name="line.57"></a>
<span class="sourceLineNo">058</span><a name="line.58"></a>
<span class="sourceLineNo">059</span>    type = DatasetParser.detectParserType(FileUtils.classpathStream("eml/sample.xml"));<a name="line.59"></a>
<span class="sourceLineNo">060</span>    assertEquals(MetadataType.EML, type);<a name="line.60"></a>
<span class="sourceLineNo">061</span><a name="line.61"></a>
<span class="sourceLineNo">062</span>    type = DatasetParser.detectParserType(FileUtils.classpathStream("eml/eml_utf8_bom.xml"));<a name="line.62"></a>
<span class="sourceLineNo">063</span>    assertEquals(MetadataType.EML, type);<a name="line.63"></a>
<span class="sourceLineNo">064</span><a name="line.64"></a>
<span class="sourceLineNo">065</span>    type = DatasetParser.detectParserType(FileUtils.classpathStream("eml/sample-breaking.xml"));<a name="line.65"></a>
<span class="sourceLineNo">066</span>    assertEquals(MetadataType.EML, type);<a name="line.66"></a>
<span class="sourceLineNo">067</span><a name="line.67"></a>
<span class="sourceLineNo">068</span>    assertIllegalArg("eml/eml-protocol.xml");<a name="line.68"></a>
<span class="sourceLineNo">069</span>    assertIllegalArg("logback-test.xml");<a name="line.69"></a>
<span class="sourceLineNo">070</span>    assertIllegalArg("dc/dc_broken.xml");<a name="line.70"></a>
<span class="sourceLineNo">071</span>  }<a name="line.71"></a>
<span class="sourceLineNo">072</span><a name="line.72"></a>
<span class="sourceLineNo">073</span>  private void assertIllegalArg(String classpathFile) throws IOException {<a name="line.73"></a>
<span class="sourceLineNo">074</span>    try {<a name="line.74"></a>
<span class="sourceLineNo">075</span>      MetadataType type = DatasetParser.detectParserType(FileUtils.classpathStream(classpathFile));<a name="line.75"></a>
<span class="sourceLineNo">076</span>      fail("IllegalArgumentException expected for file " + classpathFile + ", but found " + type);<a name="line.76"></a>
<span class="sourceLineNo">077</span>    } catch (IllegalArgumentException e) {<a name="line.77"></a>
<span class="sourceLineNo">078</span><a name="line.78"></a>
<span class="sourceLineNo">079</span>    }<a name="line.79"></a>
<span class="sourceLineNo">080</span>  }<a name="line.80"></a>
<span class="sourceLineNo">081</span><a name="line.81"></a>
<span class="sourceLineNo">082</span>  @Test(expected = IllegalArgumentException.class)<a name="line.82"></a>
<span class="sourceLineNo">083</span>  public void testBuild() throws Exception {<a name="line.83"></a>
<span class="sourceLineNo">084</span>    Dataset d = DatasetParser.build(FileUtils.classpathStream("dc/worms_dc.xml"));<a name="line.84"></a>
<span class="sourceLineNo">085</span>    assertNotNull(d);<a name="line.85"></a>
<span class="sourceLineNo">086</span><a name="line.86"></a>
<span class="sourceLineNo">087</span>    d = DatasetParser.build(FileUtils.classpathStream("eml/sample.xml"));<a name="line.87"></a>
<span class="sourceLineNo">088</span>    assertNotNull(d);<a name="line.88"></a>
<span class="sourceLineNo">089</span>    verifySample(d, false);<a name="line.89"></a>
<span class="sourceLineNo">090</span><a name="line.90"></a>
<span class="sourceLineNo">091</span>    d = DatasetParser.build(FileUtils.classpathStream("eml/ipt_eml.xml"));<a name="line.91"></a>
<span class="sourceLineNo">092</span>    assertNotNull(d);<a name="line.92"></a>
<span class="sourceLineNo">093</span>    assertEquals(new DOI("doi:10.5072/example-full"), d.getDoi());<a name="line.93"></a>
<span class="sourceLineNo">094</span><a name="line.94"></a>
<span class="sourceLineNo">095</span>    DatasetParser.build(FileUtils.classpathStream("logback-test.xml"));<a name="line.95"></a>
<span class="sourceLineNo">096</span>  }<a name="line.96"></a>
<span class="sourceLineNo">097</span><a name="line.97"></a>
<span class="sourceLineNo">098</span>  @Test<a name="line.98"></a>
<span class="sourceLineNo">099</span>  public void testWikipediaContacts() throws Exception {<a name="line.99"></a>
<span class="sourceLineNo">100</span>    Dataset d = DatasetParser.build(FileUtils.classpathStream("eml/wikipedia.xml"));<a name="line.100"></a>
<span class="sourceLineNo">101</span>    assertNotNull(d);<a name="line.101"></a>
<span class="sourceLineNo">102</span>    assertEquals(2, d.getContacts().size());<a name="line.102"></a>
<span class="sourceLineNo">103</span>    for (Contact c : d.getContacts()) {<a name="line.103"></a>
<span class="sourceLineNo">104</span>      assertEquals("Markus", c.getFirstName());<a name="line.104"></a>
<span class="sourceLineNo">105</span>      assertEquals("Döring", c.getLastName());<a name="line.105"></a>
<span class="sourceLineNo">106</span>    }<a name="line.106"></a>
<span class="sourceLineNo">107</span>  }<a name="line.107"></a>
<span class="sourceLineNo">108</span><a name="line.108"></a>
<span class="sourceLineNo">109</span>  @Test(expected = IllegalArgumentException.class)<a name="line.109"></a>
<span class="sourceLineNo">110</span>  public void testBuildProtocol() throws Exception {<a name="line.110"></a>
<span class="sourceLineNo">111</span>    Dataset d = DatasetParser.build(FileUtils.classpathStream("eml/eml-protocol.xml"));<a name="line.111"></a>
<span class="sourceLineNo">112</span>    d.getTitle();<a name="line.112"></a>
<span class="sourceLineNo">113</span>  }<a name="line.113"></a>
<span class="sourceLineNo">114</span><a name="line.114"></a>
<span class="sourceLineNo">115</span>  private Contact contactByType(Dataset d, ContactType type) {<a name="line.115"></a>
<span class="sourceLineNo">116</span>    for (Contact c : d.getContacts()) {<a name="line.116"></a>
<span class="sourceLineNo">117</span>      if (type == c.getType()) {<a name="line.117"></a>
<span class="sourceLineNo">118</span>        return c;<a name="line.118"></a>
<span class="sourceLineNo">119</span>      }<a name="line.119"></a>
<span class="sourceLineNo">120</span>    }<a name="line.120"></a>
<span class="sourceLineNo">121</span>    return null;<a name="line.121"></a>
<span class="sourceLineNo">122</span>  }<a name="line.122"></a>
<span class="sourceLineNo">123</span><a name="line.123"></a>
<span class="sourceLineNo">124</span>  private void assertIdentifierExists(Dataset d, String id, IdentifierType type) {<a name="line.124"></a>
<span class="sourceLineNo">125</span>    for (Identifier i : d.getIdentifiers()) {<a name="line.125"></a>
<span class="sourceLineNo">126</span>      if (i.getType() == type &amp;&amp; id.equals(i.getIdentifier())) {<a name="line.126"></a>
<span class="sourceLineNo">127</span>        return;<a name="line.127"></a>
<span class="sourceLineNo">128</span>      }<a name="line.128"></a>
<span class="sourceLineNo">129</span>    }<a name="line.129"></a>
<span class="sourceLineNo">130</span>    fail("Identifier " + id + " of type " + type + " missing");<a name="line.130"></a>
<span class="sourceLineNo">131</span>  }<a name="line.131"></a>
<span class="sourceLineNo">132</span><a name="line.132"></a>
<span class="sourceLineNo">133</span>  private void assertKeywordExists(Dataset d, String tag) {<a name="line.133"></a>
<span class="sourceLineNo">134</span>    for (KeywordCollection kc : d.getKeywordCollections()) {<a name="line.134"></a>
<span class="sourceLineNo">135</span>      for (String k : kc.getKeywords()) {<a name="line.135"></a>
<span class="sourceLineNo">136</span>        if (k.equals(tag)) {<a name="line.136"></a>
<span class="sourceLineNo">137</span>          return;<a name="line.137"></a>
<span class="sourceLineNo">138</span>        }<a name="line.138"></a>
<span class="sourceLineNo">139</span>      }<a name="line.139"></a>
<span class="sourceLineNo">140</span>    }<a name="line.140"></a>
<span class="sourceLineNo">141</span>    fail("Keyword" + tag + " missing");<a name="line.141"></a>
<span class="sourceLineNo">142</span>  }<a name="line.142"></a>
<span class="sourceLineNo">143</span><a name="line.143"></a>
<span class="sourceLineNo">144</span>  @Test<a name="line.144"></a>
<span class="sourceLineNo">145</span>  public void testDcParsing() throws Exception {<a name="line.145"></a>
<span class="sourceLineNo">146</span>    Dataset dataset = DatasetParser.parse(MetadataType.DC, FileUtils.classpathStream("dc/worms_dc.xml"));<a name="line.146"></a>
<span class="sourceLineNo">147</span><a name="line.147"></a>
<span class="sourceLineNo">148</span>    Calendar cal = Calendar.getInstance();<a name="line.148"></a>
<span class="sourceLineNo">149</span>    cal.clear();<a name="line.149"></a>
<span class="sourceLineNo">150</span><a name="line.150"></a>
<span class="sourceLineNo">151</span>    assertNotNull(dataset);<a name="line.151"></a>
<span class="sourceLineNo">152</span><a name="line.152"></a>
<span class="sourceLineNo">153</span>    assertEquals("World Register of Marine Species", dataset.getTitle());<a name="line.153"></a>
<span class="sourceLineNo">154</span>    assertTrue(dataset.getDescription().startsWith(<a name="line.154"></a>
<span class="sourceLineNo">155</span>      "The aim of a World Register of Marine Species (WoRMS) is to provide an authoritative and comprehensive list of names of marine organisms, including information on synonymy. While highest priority goes to valid names, other names in use are included so that this register can serve as a guide to interpret taxonomic literature."));<a name="line.155"></a>
<span class="sourceLineNo">156</span>    assertEquals("http://www.marinespecies.org/", dataset.getHomepage().toString());<a name="line.156"></a>
<span class="sourceLineNo">157</span>    assertEquals("Ward Appeltans", contactByType(dataset, ContactType.ORIGINATOR).getLastName());<a name="line.157"></a>
<span class="sourceLineNo">158</span>    assertEquals("World Register of Marine Species", dataset.getTitle());<a name="line.158"></a>
<span class="sourceLineNo">159</span>    assertEquals("World Register of Marine Species", dataset.getTitle());<a name="line.159"></a>
<span class="sourceLineNo">160</span>    assertEquals("World Register of Marine Species", dataset.getTitle());<a name="line.160"></a>
<span class="sourceLineNo">161</span><a name="line.161"></a>
<span class="sourceLineNo">162</span>    assertIdentifierExists(dataset, "1234", IdentifierType.UNKNOWN);<a name="line.162"></a>
<span class="sourceLineNo">163</span>    assertIdentifierExists(dataset, "doi:10.1093/ageing/29.1.57", IdentifierType.UNKNOWN);<a name="line.163"></a>
<span class="sourceLineNo">164</span>    assertIdentifierExists(dataset, "http://ageing.oxfordjournals.org/content/29/1/57", IdentifierType.UNKNOWN);<a name="line.164"></a>
<span class="sourceLineNo">165</span><a name="line.165"></a>
<span class="sourceLineNo">166</span>    assertKeywordExists(dataset, "Specimens");<a name="line.166"></a>
<span class="sourceLineNo">167</span>    assertKeywordExists(dataset, "Authoritative");<a name="line.167"></a>
<span class="sourceLineNo">168</span>    assertKeywordExists(dataset, "Species Checklist");<a name="line.168"></a>
<span class="sourceLineNo">169</span>    assertKeywordExists(dataset, "Taxonomy");<a name="line.169"></a>
<span class="sourceLineNo">170</span>    assertKeywordExists(dataset, "Marine");<a name="line.170"></a>
<span class="sourceLineNo">171</span>  }<a name="line.171"></a>
<span class="sourceLineNo">172</span><a name="line.172"></a>
<span class="sourceLineNo">173</span><a name="line.173"></a>
<span class="sourceLineNo">174</span>  @Test<a name="line.174"></a>
<span class="sourceLineNo">175</span>  public void testEmlParsing() {<a name="line.175"></a>
<span class="sourceLineNo">176</span>    try {<a name="line.176"></a>
<span class="sourceLineNo">177</span>      Dataset dataset = DatasetParser.parse(MetadataType.EML, FileUtils.classpathStream("eml/sample.xml"));<a name="line.177"></a>
<span class="sourceLineNo">178</span>      verifySample(dataset, false);<a name="line.178"></a>
<span class="sourceLineNo">179</span><a name="line.179"></a>
<span class="sourceLineNo">180</span>      dataset = DatasetParser.parse(MetadataType.EML, FileUtils.classpathStream("eml/sampleBadEnum.xml"));<a name="line.180"></a>
<span class="sourceLineNo">181</span>      verifySample(dataset, true);<a name="line.181"></a>
<span class="sourceLineNo">182</span><a name="line.182"></a>
<span class="sourceLineNo">183</span>    } catch (Exception e) {<a name="line.183"></a>
<span class="sourceLineNo">184</span>      e.printStackTrace();<a name="line.184"></a>
<span class="sourceLineNo">185</span>      fail();<a name="line.185"></a>
<span class="sourceLineNo">186</span>    }<a name="line.186"></a>
<span class="sourceLineNo">187</span>  }<a name="line.187"></a>
<span class="sourceLineNo">188</span><a name="line.188"></a>
<span class="sourceLineNo">189</span>  @Test<a name="line.189"></a>
<span class="sourceLineNo">190</span>  public void testRoundtripping() {<a name="line.190"></a>
<span class="sourceLineNo">191</span>    try {<a name="line.191"></a>
<span class="sourceLineNo">192</span>      Dataset dataset = DatasetParser.parse(MetadataType.EML, FileUtils.classpathStream("eml/sample.xml"));<a name="line.192"></a>
<span class="sourceLineNo">193</span>      verifySample(dataset, false);<a name="line.193"></a>
<span class="sourceLineNo">194</span><a name="line.194"></a>
<span class="sourceLineNo">195</span>      // write again to eml file and read again<a name="line.195"></a>
<span class="sourceLineNo">196</span>      StringWriter writer = new StringWriter();<a name="line.196"></a>
<span class="sourceLineNo">197</span>      EMLWriter.write(dataset, writer);<a name="line.197"></a>
<span class="sourceLineNo">198</span><a name="line.198"></a>
<span class="sourceLineNo">199</span>      final String eml = writer.toString();<a name="line.199"></a>
<span class="sourceLineNo">200</span>      System.out.println(eml);<a name="line.200"></a>
<span class="sourceLineNo">201</span>      InputStream in = new ReaderInputStream(new StringReader(eml), Charset.forName("UTF8"));<a name="line.201"></a>
<span class="sourceLineNo">202</span>      Dataset dataset2 = DatasetParser.parse(MetadataType.EML, in);<a name="line.202"></a>
<span class="sourceLineNo">203</span>      verifySample(dataset2, false);<a name="line.203"></a>
<span class="sourceLineNo">204</span><a name="line.204"></a>
<span class="sourceLineNo">205</span>    } catch (Exception e) {<a name="line.205"></a>
<span class="sourceLineNo">206</span>      e.printStackTrace();<a name="line.206"></a>
<span class="sourceLineNo">207</span>      fail();<a name="line.207"></a>
<span class="sourceLineNo">208</span>    }<a name="line.208"></a>
<span class="sourceLineNo">209</span>  }<a name="line.209"></a>
<span class="sourceLineNo">210</span><a name="line.210"></a>
<span class="sourceLineNo">211</span>  public void verifySample(Dataset dataset, boolean ignorePreservationMethod) {<a name="line.211"></a>
<span class="sourceLineNo">212</span>    Calendar cal = Calendar.getInstance();<a name="line.212"></a>
<span class="sourceLineNo">213</span>    cal.clear();<a name="line.213"></a>
<span class="sourceLineNo">214</span><a name="line.214"></a>
<span class="sourceLineNo">215</span>    assertNotNull(dataset);<a name="line.215"></a>
<span class="sourceLineNo">216</span><a name="line.216"></a>
<span class="sourceLineNo">217</span>    assertEquals(new DOI("doi:10.1093/ageing/29.1.57"), dataset.getDoi());<a name="line.217"></a>
<span class="sourceLineNo">218</span><a name="line.218"></a>
<span class="sourceLineNo">219</span>    assertIdentifierExists(dataset, "619a4b95-1a82-4006-be6a-7dbe3c9b33c5", IdentifierType.UUID);<a name="line.219"></a>
<span class="sourceLineNo">220</span>    assertIdentifierExists(dataset, "http://ageing.oxfordjournals.org/content/29/1/57", IdentifierType.URL);<a name="line.220"></a>
<span class="sourceLineNo">221</span>    assertEquals(2, dataset.getIdentifiers().size());<a name="line.221"></a>
<span class="sourceLineNo">222</span><a name="line.222"></a>
<span class="sourceLineNo">223</span>    // assertEquals(7, dataset.getEmlVersion());<a name="line.223"></a>
<span class="sourceLineNo">224</span>    assertEquals("Tanzanian Entomological Collection", dataset.getTitle());<a name="line.224"></a>
<span class="sourceLineNo">225</span><a name="line.225"></a>
<span class="sourceLineNo">226</span>    // this is complete test for agents so subsequent agent tests will not be<a name="line.226"></a>
<span class="sourceLineNo">227</span>    // so extensive<a name="line.227"></a>
<span class="sourceLineNo">228</span>    List&lt;Contact&gt; contactList = dataset.getContacts();<a name="line.228"></a>
<span class="sourceLineNo">229</span>    assertEquals(5, contactList.size());<a name="line.229"></a>
<span class="sourceLineNo">230</span><a name="line.230"></a>
<span class="sourceLineNo">231</span>    // test Creator<a name="line.231"></a>
<span class="sourceLineNo">232</span>    Contact contact = contactList.get(0);<a name="line.232"></a>
<span class="sourceLineNo">233</span>    assertEquals("DavidTheCreator", contact.getFirstName());<a name="line.233"></a>
<span class="sourceLineNo">234</span>    assertEquals("Remsen", contact.getLastName());<a name="line.234"></a>
<span class="sourceLineNo">235</span>    assertEquals("ECAT Programme Officer", contact.getPosition().get(0));<a name="line.235"></a>
<span class="sourceLineNo">236</span>    assertEquals("GBIF", contact.getOrganization());<a name="line.236"></a>
<span class="sourceLineNo">237</span>    assertEquals("Universitestparken 15", contact.getAddress().get(0));<a name="line.237"></a>
<span class="sourceLineNo">238</span>    assertEquals("Copenhagen", contact.getCity());<a name="line.238"></a>
<span class="sourceLineNo">239</span>    assertEquals("Sjaelland", contact.getProvince());<a name="line.239"></a>
<span class="sourceLineNo">240</span>    assertEquals("2100", contact.getPostalCode());<a name="line.240"></a>
<span class="sourceLineNo">241</span>    assertEquals(Country.DENMARK, contact.getCountry());<a name="line.241"></a>
<span class="sourceLineNo">242</span>    assertEquals("+4528261487", contact.getPhone().get(0));<a name="line.242"></a>
<span class="sourceLineNo">243</span>    assertEquals("dremsen@gbif.org", contact.getEmail().get(0));<a name="line.243"></a>
<span class="sourceLineNo">244</span>    assertTrue(contact.isPrimary());<a name="line.244"></a>
<span class="sourceLineNo">245</span>    assertEquals(ContactType.ORIGINATOR, contact.getType());<a name="line.245"></a>
<span class="sourceLineNo">246</span><a name="line.246"></a>
<span class="sourceLineNo">247</span>    // test Metadata provider<a name="line.247"></a>
<span class="sourceLineNo">248</span>    contact = contactList.get(1);<a name="line.248"></a>
<span class="sourceLineNo">249</span>    assertEquals("Tim", contact.getFirstName());<a name="line.249"></a>
<span class="sourceLineNo">250</span>    assertEquals("Robertson", contact.getLastName());<a name="line.250"></a>
<span class="sourceLineNo">251</span>    assertEquals("Universitestparken 15", contact.getAddress().get(0));<a name="line.251"></a>
<span class="sourceLineNo">252</span>    assertEquals("Copenhagen", contact.getCity());<a name="line.252"></a>
<span class="sourceLineNo">253</span>    assertEquals("Copenhagen", contact.getProvince());<a name="line.253"></a>
<span class="sourceLineNo">254</span>    assertEquals("2100", contact.getPostalCode());<a name="line.254"></a>
<span class="sourceLineNo">255</span>    assertEquals(Country.DENMARK, contact.getCountry());<a name="line.255"></a>
<span class="sourceLineNo">256</span>    assertEquals("+4528261487", contact.getPhone().get(0));<a name="line.256"></a>
<span class="sourceLineNo">257</span>    assertEquals("trobertson@gbif.org", contact.getEmail().get(0));<a name="line.257"></a>
<span class="sourceLineNo">258</span>    assertTrue(contact.isPrimary());<a name="line.258"></a>
<span class="sourceLineNo">259</span>    assertEquals(ContactType.METADATA_AUTHOR, contact.getType());<a name="line.259"></a>
<span class="sourceLineNo">260</span>    assertEquals("http://orcid.org/0000-0001-5337-1153", contact.getUserId().get(0));<a name="line.260"></a>
<span class="sourceLineNo">261</span>    assertEquals("gbif:153", contact.getUserId().get(1));<a name="line.261"></a>
<span class="sourceLineNo">262</span><a name="line.262"></a>
<span class="sourceLineNo">263</span>    // test Contact<a name="line.263"></a>
<span class="sourceLineNo">264</span>    contact = contactList.get(4);<a name="line.264"></a>
<span class="sourceLineNo">265</span>    assertEquals("David", contact.getFirstName());<a name="line.265"></a>
<span class="sourceLineNo">266</span>    assertEquals("Remsen", contact.getLastName());<a name="line.266"></a>
<span class="sourceLineNo">267</span>    assertEquals("ECAT Programme Officer", contact.getPosition().get(0));<a name="line.267"></a>
<span class="sourceLineNo">268</span>    assertEquals("GBIF", contact.getOrganization());<a name="line.268"></a>
<span class="sourceLineNo">269</span>    assertEquals("Universitestparken 15", contact.getAddress().get(0));<a name="line.269"></a>
<span class="sourceLineNo">270</span>    assertEquals("Copenhagen", contact.getCity());<a name="line.270"></a>
<span class="sourceLineNo">271</span>    assertEquals("Sjaelland", contact.getProvince());<a name="line.271"></a>
<span class="sourceLineNo">272</span>    assertEquals("2100", contact.getPostalCode());<a name="line.272"></a>
<span class="sourceLineNo">273</span>    assertEquals(Country.DENMARK, contact.getCountry());<a name="line.273"></a>
<span class="sourceLineNo">274</span>    assertEquals("+4528261487", contact.getPhone().get(0));<a name="line.274"></a>
<span class="sourceLineNo">275</span>    assertEquals("dremsen@gbif.org", contact.getEmail().get(0));<a name="line.275"></a>
<span class="sourceLineNo">276</span>    assertTrue(contact.isPrimary());<a name="line.276"></a>
<span class="sourceLineNo">277</span>    assertEquals(ContactType.ADMINISTRATIVE_POINT_OF_CONTACT, contact.getType());<a name="line.277"></a>
<span class="sourceLineNo">278</span><a name="line.278"></a>
<span class="sourceLineNo">279</span>    // test limited agent with role tests<a name="line.279"></a>
<span class="sourceLineNo">280</span>    contact = contactList.get(2);<a name="line.280"></a>
<span class="sourceLineNo">281</span>    assertEquals(ContactType.PRINCIPAL_INVESTIGATOR, contact.getType());<a name="line.281"></a>
<span class="sourceLineNo">282</span>    assertFalse(contact.isPrimary());<a name="line.282"></a>
<span class="sourceLineNo">283</span>    assertEquals("Markus", contact.getFirstName());<a name="line.283"></a>
<span class="sourceLineNo">284</span>    assertEquals("Döring", contact.getLastName());<a name="line.284"></a>
<span class="sourceLineNo">285</span>    assertEquals("2nd floor", contact.getAddress().get(0));<a name="line.285"></a>
<span class="sourceLineNo">286</span>    assertEquals("Universitestparken 15", contact.getAddress().get(1));<a name="line.286"></a>
<span class="sourceLineNo">287</span>    assertEquals("Copenhagen", contact.getCity());<a name="line.287"></a>
<span class="sourceLineNo">288</span>    assertEquals("Copenhagen", contact.getProvince());<a name="line.288"></a>
<span class="sourceLineNo">289</span>    assertEquals("2100", contact.getPostalCode());<a name="line.289"></a>
<span class="sourceLineNo">290</span>    assertEquals(Country.DENMARK, contact.getCountry());<a name="line.290"></a>
<span class="sourceLineNo">291</span>    assertEquals("+45 35321 487", contact.getPhone().get(0));<a name="line.291"></a>
<span class="sourceLineNo">292</span>    assertEquals("+45 35321 488", contact.getPhone().get(1));<a name="line.292"></a>
<span class="sourceLineNo">293</span>    assertEquals("mdoering@gbif.org", contact.getEmail().get(0));<a name="line.293"></a>
<span class="sourceLineNo">294</span>    assertEquals("mdoering@mailinator.com", contact.getEmail().get(1));<a name="line.294"></a>
<span class="sourceLineNo">295</span>    assertEquals("http://www.gbif.org", contact.getHomepage().get(0).toString());<a name="line.295"></a>
<span class="sourceLineNo">296</span>    assertEquals("http://www.gbif-dev.org", contact.getHomepage().get(1).toString());<a name="line.296"></a>
<span class="sourceLineNo">297</span><a name="line.297"></a>
<span class="sourceLineNo">298</span><a name="line.298"></a>
<span class="sourceLineNo">299</span>    contact = contactList.get(3);<a name="line.299"></a>
<span class="sourceLineNo">300</span>    // assertEquals("pointOfContact", contact.getRole());<a name="line.300"></a>
<span class="sourceLineNo">301</span>    assertEquals(ContactType.POINT_OF_CONTACT, contact.getType());<a name="line.301"></a>
<span class="sourceLineNo">302</span>    assertFalse(contact.isPrimary());<a name="line.302"></a>
<span class="sourceLineNo">303</span><a name="line.303"></a>
<span class="sourceLineNo">304</span>    // Publication Date<a name="line.304"></a>
<span class="sourceLineNo">305</span>    cal.clear();<a name="line.305"></a>
<span class="sourceLineNo">306</span>    cal.set(2010, Calendar.FEBRUARY, 2);<a name="line.306"></a>
<span class="sourceLineNo">307</span>    assertEquals(cal.getTime(), dataset.getPubDate());<a name="line.307"></a>
<span class="sourceLineNo">308</span><a name="line.308"></a>
<span class="sourceLineNo">309</span>    // WritableDataset properties<a name="line.309"></a>
<span class="sourceLineNo">310</span>    // xml:lang="en"<a name="line.310"></a>
<span class="sourceLineNo">311</span>    assertEquals(Language.ENGLISH, dataset.getLanguage());<a name="line.311"></a>
<span class="sourceLineNo">312</span>    // &lt;language&gt;en&lt;/language&gt;<a name="line.312"></a>
<span class="sourceLineNo">313</span>    assertEquals(Language.ENGLISH, dataset.getDataLanguage());<a name="line.313"></a>
<span class="sourceLineNo">314</span>    assertEquals("Specimens in jars.\nCollected over years.\nStill being curated.", dataset.getDescription());<a name="line.314"></a>
<span class="sourceLineNo">315</span>    assertEquals(buildURI("http://www.any.org/fauna/coleoptera/beetleList.html"), dataset.getHomepage());<a name="line.315"></a>
<span class="sourceLineNo">316</span>    assertEquals(buildURI("http://www.tim.org/logo.jpg"), dataset.getLogoUrl());<a name="line.316"></a>
<span class="sourceLineNo">317</span><a name="line.317"></a>
<span class="sourceLineNo">318</span>    // KeywordSets<a name="line.318"></a>
<span class="sourceLineNo">319</span>    assertNotNull(dataset.getKeywordCollections());<a name="line.319"></a>
<span class="sourceLineNo">320</span>    assertEquals(2, dataset.getKeywordCollections().size());<a name="line.320"></a>
<span class="sourceLineNo">321</span>    assertNotNull(dataset.getKeywordCollections().get(0).getKeywords());<a name="line.321"></a>
<span class="sourceLineNo">322</span>    assertEquals(3, dataset.getKeywordCollections().get(0).getKeywords().size());<a name="line.322"></a>
<span class="sourceLineNo">323</span>    assertTrue(dataset.getKeywordCollections().get(0).getKeywords().contains("Insect"));<a name="line.323"></a>
<span class="sourceLineNo">324</span>    assertTrue(dataset.getKeywordCollections().get(0).getKeywords().contains("Insect"));<a name="line.324"></a>
<span class="sourceLineNo">325</span>    assertTrue(dataset.getKeywordCollections().get(0).getKeywords().contains("Insect"));<a name="line.325"></a>
<span class="sourceLineNo">326</span>    assertEquals("Zoology Vocabulary Version 1", dataset.getKeywordCollections().get(0).getThesaurus());<a name="line.326"></a>
<span class="sourceLineNo">327</span>    assertEquals(1, dataset.getKeywordCollections().get(1).getKeywords().size());<a name="line.327"></a>
<span class="sourceLineNo">328</span>    assertTrue(dataset.getKeywordCollections().get(1).getKeywords().contains("Spider"));<a name="line.328"></a>
<span class="sourceLineNo">329</span>    assertEquals("Zoology Vocabulary Version 1", dataset.getKeywordCollections().get(1).getThesaurus());<a name="line.329"></a>
<span class="sourceLineNo">330</span><a name="line.330"></a>
<span class="sourceLineNo">331</span>    // geospatial coverages tests<a name="line.331"></a>
<span class="sourceLineNo">332</span>    assertNotNull(dataset.getGeographicCoverages());<a name="line.332"></a>
<span class="sourceLineNo">333</span>    assertEquals(2, dataset.getGeographicCoverages().size());<a name="line.333"></a>
<span class="sourceLineNo">334</span>    assertEquals("Bounding Box 1", dataset.getGeographicCoverages().get(0).getDescription());<a name="line.334"></a>
<span class="sourceLineNo">335</span>    assertEquals("23.975", String.valueOf(dataset.getGeographicCoverages().get(0).getBoundingBox().getMaxLatitude()));<a name="line.335"></a>
<span class="sourceLineNo">336</span>    assertEquals("0.703", String.valueOf(dataset.getGeographicCoverages().get(0).getBoundingBox().getMaxLongitude()));<a name="line.336"></a>
<span class="sourceLineNo">337</span>    assertEquals("-22.745", String.valueOf(dataset.getGeographicCoverages().get(0).getBoundingBox().getMinLatitude()));<a name="line.337"></a>
<span class="sourceLineNo">338</span>    assertEquals("-1.564", String.valueOf(dataset.getGeographicCoverages().get(0).getBoundingBox().getMinLongitude()));<a name="line.338"></a>
<span class="sourceLineNo">339</span>    assertEquals("Bounding Box 2", dataset.getGeographicCoverages().get(1).getDescription());<a name="line.339"></a>
<span class="sourceLineNo">340</span>    assertEquals("43.975", String.valueOf(dataset.getGeographicCoverages().get(1).getBoundingBox().getMaxLatitude()));<a name="line.340"></a>
<span class="sourceLineNo">341</span>    assertEquals("11.564", String.valueOf(dataset.getGeographicCoverages().get(1).getBoundingBox().getMaxLongitude()));<a name="line.341"></a>
<span class="sourceLineNo">342</span>    assertEquals("-32.745", String.valueOf(dataset.getGeographicCoverages().get(1).getBoundingBox().getMinLatitude()));<a name="line.342"></a>
<span class="sourceLineNo">343</span>    assertEquals("-10.703", String.valueOf(dataset.getGeographicCoverages().get(1).getBoundingBox().getMinLongitude()));<a name="line.343"></a>
<span class="sourceLineNo">344</span><a name="line.344"></a>
<span class="sourceLineNo">345</span>    // temporal coverages tests<a name="line.345"></a>
<span class="sourceLineNo">346</span>    assertEquals(4, dataset.getTemporalCoverages().size());<a name="line.346"></a>
<span class="sourceLineNo">347</span>    cal.clear();<a name="line.347"></a>
<span class="sourceLineNo">348</span>    cal.set(2009, Calendar.DECEMBER, 1);<a name="line.348"></a>
<span class="sourceLineNo">349</span>    assertEquals(DateRange.class, dataset.getTemporalCoverages().get(0).getClass());<a name="line.349"></a>
<span class="sourceLineNo">350</span>    DateRange d = (DateRange) dataset.getTemporalCoverages().get(0);<a name="line.350"></a>
<span class="sourceLineNo">351</span>    assertEquals(cal.getTime(), d.getStart());<a name="line.351"></a>
<span class="sourceLineNo">352</span>    cal.set(2009, Calendar.DECEMBER, 30);<a name="line.352"></a>
<span class="sourceLineNo">353</span>    assertEquals(cal.getTime(), d.getEnd());<a name="line.353"></a>
<span class="sourceLineNo">354</span><a name="line.354"></a>
<span class="sourceLineNo">355</span>    assertEquals(SingleDate.class, dataset.getTemporalCoverages().get(1).getClass());<a name="line.355"></a>
<span class="sourceLineNo">356</span>    cal.set(2008, Calendar.JUNE, 1);<a name="line.356"></a>
<span class="sourceLineNo">357</span>    SingleDate d2 = (SingleDate) dataset.getTemporalCoverages().get(1);<a name="line.357"></a>
<span class="sourceLineNo">358</span>    assertEquals(cal.getTime(), d2.getDate());<a name="line.358"></a>
<span class="sourceLineNo">359</span><a name="line.359"></a>
<span class="sourceLineNo">360</span>    assertEquals(VerbatimTimePeriod.class, dataset.getTemporalCoverages().get(2).getClass());<a name="line.360"></a>
<span class="sourceLineNo">361</span>    VerbatimTimePeriod d3 = (VerbatimTimePeriod) dataset.getTemporalCoverages().get(2);<a name="line.361"></a>
<span class="sourceLineNo">362</span>    assertEquals("During the 70s", d3.getPeriod());<a name="line.362"></a>
<span class="sourceLineNo">363</span>    assertEquals(VerbatimTimePeriodType.FORMATION_PERIOD, d3.getType());<a name="line.363"></a>
<span class="sourceLineNo">364</span><a name="line.364"></a>
<span class="sourceLineNo">365</span>    assertEquals(VerbatimTimePeriod.class, dataset.getTemporalCoverages().get(3).getClass());<a name="line.365"></a>
<span class="sourceLineNo">366</span>    d3 = (VerbatimTimePeriod) dataset.getTemporalCoverages().get(3);<a name="line.366"></a>
<span class="sourceLineNo">367</span>    assertEquals("Jurassic", d3.getPeriod());<a name="line.367"></a>
<span class="sourceLineNo">368</span>    assertEquals(VerbatimTimePeriodType.LIVING_TIME_PERIOD, d3.getType());<a name="line.368"></a>
<span class="sourceLineNo">369</span><a name="line.369"></a>
<span class="sourceLineNo">370</span>    // taxonomic coverages tests<a name="line.370"></a>
<span class="sourceLineNo">371</span>    assertNotNull(dataset.getTaxonomicCoverages());<a name="line.371"></a>
<span class="sourceLineNo">372</span>    assertEquals(2, dataset.getTaxonomicCoverages().size());<a name="line.372"></a>
<span class="sourceLineNo">373</span>    assertEquals("This is a general taxon coverage with only the scientific name",<a name="line.373"></a>
<span class="sourceLineNo">374</span>      dataset.getTaxonomicCoverages().get(0).getDescription());<a name="line.374"></a>
<span class="sourceLineNo">375</span>    assertEquals("Mammalia", dataset.getTaxonomicCoverages().get(0).getCoverages().get(0).getScientificName());<a name="line.375"></a>
<span class="sourceLineNo">376</span>    assertEquals("Reptilia", dataset.getTaxonomicCoverages().get(0).getCoverages().get(1).getScientificName());<a name="line.376"></a>
<span class="sourceLineNo">377</span>    assertEquals("Coleoptera", dataset.getTaxonomicCoverages().get(0).getCoverages().get(2).getScientificName());<a name="line.377"></a>
<span class="sourceLineNo">378</span><a name="line.378"></a>
<span class="sourceLineNo">379</span>    assertEquals("This is a second taxon coverage with all fields",<a name="line.379"></a>
<span class="sourceLineNo">380</span>      dataset.getTaxonomicCoverages().get(1).getDescription());<a name="line.380"></a>
<span class="sourceLineNo">381</span>    // 1st classification<a name="line.381"></a>
<span class="sourceLineNo">382</span>    assertEquals("Class", dataset.getTaxonomicCoverages().get(1).getCoverages().get(0).getRank().getVerbatim());<a name="line.382"></a>
<span class="sourceLineNo">383</span>    assertEquals(Rank.CLASS, dataset.getTaxonomicCoverages().get(1).getCoverages().get(0).getRank().getInterpreted());<a name="line.383"></a>
<span class="sourceLineNo">384</span>    assertEquals("Aves", dataset.getTaxonomicCoverages().get(1).getCoverages().get(0).getScientificName());<a name="line.384"></a>
<span class="sourceLineNo">385</span>    assertEquals("Birds", dataset.getTaxonomicCoverages().get(1).getCoverages().get(0).getCommonName());<a name="line.385"></a>
<span class="sourceLineNo">386</span>    // 2nd classification<a name="line.386"></a>
<span class="sourceLineNo">387</span>    assertEquals("Kingdom", dataset.getTaxonomicCoverages().get(1).getCoverages().get(1).getRank().getVerbatim());<a name="line.387"></a>
<span class="sourceLineNo">388</span>    assertEquals(Rank.KINGDOM, dataset.getTaxonomicCoverages().get(1).getCoverages().get(1).getRank().getInterpreted());<a name="line.388"></a>
<span class="sourceLineNo">389</span>    assertEquals("Plantae", dataset.getTaxonomicCoverages().get(1).getCoverages().get(1).getScientificName());<a name="line.389"></a>
<span class="sourceLineNo">390</span>    assertEquals("Plants", dataset.getTaxonomicCoverages().get(1).getCoverages().get(1).getCommonName());<a name="line.390"></a>
<span class="sourceLineNo">391</span>    // 3nd classification with uninterpretable Rank. Only the verbatim value is preserved<a name="line.391"></a>
<span class="sourceLineNo">392</span>    assertEquals("kingggggggggggggdom",<a name="line.392"></a>
<span class="sourceLineNo">393</span>      dataset.getTaxonomicCoverages().get(1).getCoverages().get(2).getRank().getVerbatim());<a name="line.393"></a>
<span class="sourceLineNo">394</span>    assertNull(dataset.getTaxonomicCoverages().get(1).getCoverages().get(2).getRank().getInterpreted());<a name="line.394"></a>
<span class="sourceLineNo">395</span>    assertEquals("Animalia", dataset.getTaxonomicCoverages().get(1).getCoverages().get(2).getScientificName());<a name="line.395"></a>
<span class="sourceLineNo">396</span>    assertEquals("Animals", dataset.getTaxonomicCoverages().get(1).getCoverages().get(2).getCommonName());<a name="line.396"></a>
<span class="sourceLineNo">397</span><a name="line.397"></a>
<span class="sourceLineNo">398</span>    // sampling methods<a name="line.398"></a>
<span class="sourceLineNo">399</span>    assertNotNull(dataset.getSamplingDescription());<a name="line.399"></a>
<span class="sourceLineNo">400</span>    assertEquals(3, dataset.getSamplingDescription().getMethodSteps().size());<a name="line.400"></a>
<span class="sourceLineNo">401</span>    assertEquals("Took picture, identified", dataset.getSamplingDescription().getMethodSteps().get(0));<a name="line.401"></a>
<span class="sourceLineNo">402</span>    assertEquals("Themometer based test", dataset.getSamplingDescription().getMethodSteps().get(1));<a name="line.402"></a>
<span class="sourceLineNo">403</span>    assertEquals("Visual based test\nand one more time", dataset.getSamplingDescription().getMethodSteps().get(2));<a name="line.403"></a>
<span class="sourceLineNo">404</span>    assertEquals("Daily Obersevation of Pigeons Eating Habits", dataset.getSamplingDescription().getStudyExtent());<a name="line.404"></a>
<span class="sourceLineNo">405</span>    assertEquals("44KHz is what a CD has... I was more like one a day if I felt like it",<a name="line.405"></a>
<span class="sourceLineNo">406</span>      dataset.getSamplingDescription().getSampling());<a name="line.406"></a>
<span class="sourceLineNo">407</span>    assertEquals("None", dataset.getSamplingDescription().getQualityControl());<a name="line.407"></a>
<span class="sourceLineNo">408</span><a name="line.408"></a>
<span class="sourceLineNo">409</span>    // Project (not included is attribute citableClassificationSystem)<a name="line.409"></a>
<span class="sourceLineNo">410</span>    assertNotNull(dataset.getProject());<a name="line.410"></a>
<span class="sourceLineNo">411</span>    assertEquals("Documenting Some Asian Birds and Insects", dataset.getProject().getTitle());<a name="line.411"></a>
<span class="sourceLineNo">412</span>    assertNotNull(dataset.getProject().getContacts());<a name="line.412"></a>
<span class="sourceLineNo">413</span>    assertEquals("Remsen", dataset.getProject().getContacts().get(0).getLastName());<a name="line.413"></a>
<span class="sourceLineNo">414</span>    assertEquals(ContactType.PUBLISHER, dataset.getProject().getContacts().get(0).getType());<a name="line.414"></a>
<span class="sourceLineNo">415</span>    assertEquals("My Deep Pockets", dataset.getProject().getFunding());<a name="line.415"></a>
<span class="sourceLineNo">416</span>    assertEquals("Turkish Mountains", dataset.getProject().getStudyAreaDescription());<a name="line.416"></a>
<span class="sourceLineNo">417</span>    assertEquals("This was done in Avian Migration patterns", dataset.getProject().getDesignDescription());<a name="line.417"></a>
<span class="sourceLineNo">418</span><a name="line.418"></a>
<span class="sourceLineNo">419</span>    assertEquals(Language.ENGLISH, dataset.getLanguage());<a name="line.419"></a>
<span class="sourceLineNo">420</span><a name="line.420"></a>
<span class="sourceLineNo">421</span>    // cal.clear();<a name="line.421"></a>
<span class="sourceLineNo">422</span>    // // 2002-10-23T18:13:51<a name="line.422"></a>
<span class="sourceLineNo">423</span>    // SimpleTimeZone tz = new SimpleTimeZone(1000 * 60 * 60, "berlin");<a name="line.423"></a>
<span class="sourceLineNo">424</span>    // cal.setTimeZone(tz);<a name="line.424"></a>
<span class="sourceLineNo">425</span>    // cal.set(2002, Calendar.OCTOBER, 23, 18, 13, 51);<a name="line.425"></a>
<span class="sourceLineNo">426</span>    // cal.set(Calendar.MILLISECOND, 235);<a name="line.426"></a>
<span class="sourceLineNo">427</span>    // assertEquals(cal.getTime(), dataset.getDateStamp());<a name="line.427"></a>
<span class="sourceLineNo">428</span><a name="line.428"></a>
<span class="sourceLineNo">429</span>    // Single Citation<a name="line.429"></a>
<span class="sourceLineNo">430</span>    assertEquals("doi:tims-ident.2135.ex43.33.d", dataset.getCitation().getIdentifier());<a name="line.430"></a>
<span class="sourceLineNo">431</span>    assertEquals("Tims assembled checklist", dataset.getCitation().getText());<a name="line.431"></a>
<span class="sourceLineNo">432</span><a name="line.432"></a>
<span class="sourceLineNo">433</span>    // Bibliographic citations<a name="line.433"></a>
<span class="sourceLineNo">434</span>    assertNotNull(dataset.getBibliographicCitations());<a name="line.434"></a>
<span class="sourceLineNo">435</span>    assertEquals(3, dataset.getBibliographicCitations().size());<a name="line.435"></a>
<span class="sourceLineNo">436</span>    assertNotNull(dataset.getBibliographicCitations().get(0));<a name="line.436"></a>
<span class="sourceLineNo">437</span>    assertEquals("title 1", dataset.getBibliographicCitations().get(0).getText());<a name="line.437"></a>
<span class="sourceLineNo">438</span>    assertEquals("title 2", dataset.getBibliographicCitations().get(1).getText());<a name="line.438"></a>
<span class="sourceLineNo">439</span>    assertEquals("title 3", dataset.getBibliographicCitations().get(2).getText());<a name="line.439"></a>
<span class="sourceLineNo">440</span>    assertEquals("doi:tims-ident.2136.ex43.33.d", dataset.getBibliographicCitations().get(0).getIdentifier());<a name="line.440"></a>
<span class="sourceLineNo">441</span>    assertEquals("doi:tims-ident.2137.ex43.33.d", dataset.getBibliographicCitations().get(1).getIdentifier());<a name="line.441"></a>
<span class="sourceLineNo">442</span>    assertEquals("doi:tims-ident.2138.ex43.33.d", dataset.getBibliographicCitations().get(2).getIdentifier());<a name="line.442"></a>
<span class="sourceLineNo">443</span><a name="line.443"></a>
<span class="sourceLineNo">444</span>    // assertEquals("dataset", dataset.getHierarchyLevel());<a name="line.444"></a>
<span class="sourceLineNo">445</span><a name="line.445"></a>
<span class="sourceLineNo">446</span>    // Data description (Physical data aka external links)<a name="line.446"></a>
<span class="sourceLineNo">447</span>    assertNotNull(dataset.getDataDescriptions());<a name="line.447"></a>
<span class="sourceLineNo">448</span>    assertEquals(2, dataset.getDataDescriptions().size());<a name="line.448"></a>
<span class="sourceLineNo">449</span>    assertEquals("INV-GCEM-0305a1_1_1.shp", dataset.getDataDescriptions().get(0).getName());<a name="line.449"></a>
<span class="sourceLineNo">450</span>    assertEquals("ASCII", dataset.getDataDescriptions().get(0).getCharset());<a name="line.450"></a>
<span class="sourceLineNo">451</span>    assertEquals("shapefile", dataset.getDataDescriptions().get(0).getFormat());<a name="line.451"></a>
<span class="sourceLineNo">452</span>    assertEquals("2.0", dataset.getDataDescriptions().get(0).getFormatVersion());<a name="line.452"></a>
<span class="sourceLineNo">453</span>    assertEquals(buildURI(<a name="line.453"></a>
<span class="sourceLineNo">454</span>        "http://metacat.lternet.edu/knb/dataAccessServlet?docid=knb-lter-gce.109.10&amp;urlTail=accession=INV-GCEM-0305a1&amp;filename=INV-GCEM-0305a1_1_1.TXT"),<a name="line.454"></a>
<span class="sourceLineNo">455</span>      dataset.getDataDescriptions().get(0).getUrl());<a name="line.455"></a>
<span class="sourceLineNo">456</span>    assertEquals("INV-GCEM-0305a1_1_2.shp", dataset.getDataDescriptions().get(1).getName());<a name="line.456"></a>
<span class="sourceLineNo">457</span>    assertEquals("ASCII", dataset.getDataDescriptions().get(1).getCharset());<a name="line.457"></a>
<span class="sourceLineNo">458</span>    assertEquals("shapefile", dataset.getDataDescriptions().get(1).getFormat());<a name="line.458"></a>
<span class="sourceLineNo">459</span>    assertEquals("2.0", dataset.getDataDescriptions().get(1).getFormatVersion());<a name="line.459"></a>
<span class="sourceLineNo">460</span>    assertEquals(buildURI(<a name="line.460"></a>
<span class="sourceLineNo">461</span>        "http://metacat.lternet.edu/knb/dataAccessServlet?docid=knb-lter-gce.109.10&amp;urlTail=accession=INV-GCEM-0305a1&amp;filename=INV-GCEM-0305a1_1_2.TXT"),<a name="line.461"></a>
<span class="sourceLineNo">462</span>      dataset.getDataDescriptions().get(1).getUrl());<a name="line.462"></a>
<span class="sourceLineNo">463</span><a name="line.463"></a>
<span class="sourceLineNo">464</span>    assertEquals("Provide data to the whole world.", dataset.getPurpose());<a name="line.464"></a>
<span class="sourceLineNo">465</span>    assertEquals("Where can the additional information possibly come from?!", dataset.getAdditionalInfo());<a name="line.465"></a>
<span class="sourceLineNo">466</span><a name="line.466"></a>
<span class="sourceLineNo">467</span>    // intellectual rights tests<a name="line.467"></a>
<span class="sourceLineNo">468</span>    assertNotNull(dataset.getRights());<a name="line.468"></a>
<span class="sourceLineNo">469</span>    assertTrue(dataset.getRights().startsWith("Owner grants"));<a name="line.469"></a>
<span class="sourceLineNo">470</span>    assertTrue(dataset.getRights().endsWith("Site)."));<a name="line.470"></a>
<span class="sourceLineNo">471</span><a name="line.471"></a>
<span class="sourceLineNo">472</span>    // Collection<a name="line.472"></a>
<span class="sourceLineNo">473</span>    Collection collection = dataset.getCollections().get(0);<a name="line.473"></a>
<span class="sourceLineNo">474</span>    if (!ignorePreservationMethod) {<a name="line.474"></a>
<span class="sourceLineNo">475</span>      assertEquals(PreservationMethodType.ALCOHOL, collection.getSpecimenPreservationMethod());<a name="line.475"></a>
<span class="sourceLineNo">476</span>    }<a name="line.476"></a>
<span class="sourceLineNo">477</span>    assertEquals("urn:lsid:tim.org:12:1", collection.getParentIdentifier());<a name="line.477"></a>
<span class="sourceLineNo">478</span>    assertEquals("urn:lsid:tim.org:12:2", collection.getIdentifier());<a name="line.478"></a>
<span class="sourceLineNo">479</span>    assertEquals("Mammals", collection.getName());<a name="line.479"></a>
<span class="sourceLineNo">480</span>    // JGTI curatorial unit tests inside Collection<a name="line.480"></a>
<span class="sourceLineNo">481</span>    assertNotNull(dataset.getCollections().get(0).getCuratorialUnits());<a name="line.481"></a>
<span class="sourceLineNo">482</span>    assertEquals(5, dataset.getCollections().get(0).getCuratorialUnits().get(0).getCount());<a name="line.482"></a>
<span class="sourceLineNo">483</span>    assertEquals(1, dataset.getCollections().get(0).getCuratorialUnits().get(0).getDeviation());<a name="line.483"></a>
<span class="sourceLineNo">484</span>    assertEquals("SPECIMENS", dataset.getCollections().get(0).getCuratorialUnits().get(0).getTypeVerbatim());<a name="line.484"></a>
<span class="sourceLineNo">485</span>    assertEquals("Drawers", dataset.getCollections().get(0).getCuratorialUnits().get(1).getTypeVerbatim());<a name="line.485"></a>
<span class="sourceLineNo">486</span>    assertEquals(7, dataset.getCollections().get(0).getCuratorialUnits().get(1).getLower());<a name="line.486"></a>
<span class="sourceLineNo">487</span>    assertEquals(2, dataset.getCollections().get(0).getCuratorialUnits().get(1).getUpper());<a name="line.487"></a>
<span class="sourceLineNo">488</span>  }<a name="line.488"></a>
<span class="sourceLineNo">489</span><a name="line.489"></a>
<span class="sourceLineNo">490</span>  @Test<a name="line.490"></a>
<span class="sourceLineNo">491</span>  public void testEmlParsingBreaking() throws IOException {<a name="line.491"></a>
<span class="sourceLineNo">492</span>    // throws a ConversionException/Throwable that is caught - but build still returns the dataset populated partially<a name="line.492"></a>
<span class="sourceLineNo">493</span>    Dataset dataset = DatasetParser.parse(MetadataType.EML, FileUtils.classpathStream("eml/sample-breaking.xml"));<a name="line.493"></a>
<span class="sourceLineNo">494</span>    assertEquals("Estimates of walleye abundance for Oneida\n" + "      Lake, NY (1957-2008)", dataset.getTitle());<a name="line.494"></a>
<span class="sourceLineNo">495</span>  }<a name="line.495"></a>
<span class="sourceLineNo">496</span><a name="line.496"></a>
<span class="sourceLineNo">497</span>  /**<a name="line.497"></a>
<span class="sourceLineNo">498</span>   * POR-2792: Handle &lt;pre&gt;&lt;ulink&gt;&lt;/pre&gt; elements in intellectualRights.<a name="line.498"></a>
<span class="sourceLineNo">499</span>   */<a name="line.499"></a>
<span class="sourceLineNo">500</span>  @Test<a name="line.500"></a>
<span class="sourceLineNo">501</span>  public void testEmbeddedUlinkElements() throws IOException {<a name="line.501"></a>
<span class="sourceLineNo">502</span>    Dataset dataset = DatasetParser.parse(MetadataType.EML, FileUtils.classpathStream("eml/sample-ulink.xml"));<a name="line.502"></a>
<span class="sourceLineNo">503</span>    assertEquals("Creative Commons Attribution (CC-BY) 4.0 License", dataset.getRights());<a name="line.503"></a>
<span class="sourceLineNo">504</span><a name="line.504"></a>
<span class="sourceLineNo">505</span>    // check original behaviour<a name="line.505"></a>
<span class="sourceLineNo">506</span>    dataset = DatasetParser.parse(MetadataType.EML, FileUtils.classpathStream("eml/sample-no-ulink.xml"));<a name="line.506"></a>
<span class="sourceLineNo">507</span>    assertEquals("This work is licensed under a Creative Commons Attribution (CC-BY) 4.0 License.", dataset.getRights());<a name="line.507"></a>
<span class="sourceLineNo">508</span>  }<a name="line.508"></a>
<span class="sourceLineNo">509</span><a name="line.509"></a>
<span class="sourceLineNo">510</span><a name="line.510"></a>
<span class="sourceLineNo">511</span>  @Test<a name="line.511"></a>
<span class="sourceLineNo">512</span>  public void testEmlParsingBreakingOnURLConversion() throws IOException {<a name="line.512"></a>
<span class="sourceLineNo">513</span>    // Gracefully handles ConversionException/Throwable during conversion of URLs, and fully populates the dataset<a name="line.513"></a>
<span class="sourceLineNo">514</span>    Dataset dataset = DatasetParser.parse(MetadataType.EML, FileUtils.classpathStream("eml/sample-breaking2.xml"));<a name="line.514"></a>
<span class="sourceLineNo">515</span>    assertEquals("WII Herbarium Dataset", dataset.getTitle());<a name="line.515"></a>
<span class="sourceLineNo">516</span>    assertEquals(buildURI("http://www.wii.gov.in"), dataset.getHomepage());<a name="line.516"></a>
<span class="sourceLineNo">517</span>  }<a name="line.517"></a>
<span class="sourceLineNo">518</span><a name="line.518"></a>
<span class="sourceLineNo">519</span>  private URI buildURI(String uri) {<a name="line.519"></a>
<span class="sourceLineNo">520</span>    try {<a name="line.520"></a>
<span class="sourceLineNo">521</span>      return new URL(uri).toURI();<a name="line.521"></a>
<span class="sourceLineNo">522</span>    } catch (URISyntaxException e) {<a name="line.522"></a>
<span class="sourceLineNo">523</span>    } catch (MalformedURLException e) {<a name="line.523"></a>
<span class="sourceLineNo">524</span>    }<a name="line.524"></a>
<span class="sourceLineNo">525</span>    return null;<a name="line.525"></a>
<span class="sourceLineNo">526</span>  }<a name="line.526"></a>
<span class="sourceLineNo">527</span>}<a name="line.527"></a>




























































</pre>
</div>
</body>
</html>